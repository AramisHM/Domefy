<!--
File: spaceship_controls.html
Project: FpMED - Framework for Distributed Multiprojection Systems
File Created: Tuesday, 30th July 2019 3:24:20 pm
Author: Aramis Hornung Moraes (aramishm@gmail.com)
-----
Last Modified: Tuesday, 30th July 2019 3:24:34 pm
Modified By: Aramis Hornung Moraes (aramishm@gmail.com>)
-----
Copyright 2014 - 2019 Aramis Hornung Moraes
-->

<!-- touch Joystick controls prototype -->
<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    /* class to disable scrolling in the page */
    .noScroll {
        overflow-y: hidden;
        overscroll-behavior: none;
    }

    /* The region with for the touch enabled input */
    .joystick {
        width: 300px;
        height: 300px;
        border: 1px solid;

        z-index: 2;
    }

    /*  the image with the image for representing the joystick thumb */
    .joystick-point {}
</style>

<body class="noScroll">
    <p id="demo">
        Touch controls
    </p>
    <div class="joystick" ontouchmove="touchAction(event)">
        <img id="thumbstickpointer" style="position:absolute" src=" ../../assets/images/marker.png">
        </img>
    </div>

    <button data-toggle-fullscreen>Toggle Fullscreen</button>

    <!-- utilities for sending ajax etc -->
    <script type="text/javascript" src="../../domefy/utils.js"></script>
    <script type="text/javascript" src="../../config.js"></script>
    <script src="../../jquery/jquery.min.js"></script>

    <script>
        //  keeps track of ou gestures deslocation
        var touchHistoryData = {
            position: {
                x: 0,
                y: 0
            },
            touch_start: {
                x: 0,
                y: 0
            }
        }
        window.addEventListener('touchstart', function (event) {
            touchHistoryData.touch_start.x = event.touches[0].clientX;
            touchHistoryData.touch_start.y = event.touches[0].clientY;
        });

        // touchAction - Get the touch event input of the first finger and send this to the application through ajax
        function touchAction(event) {
            var x = Math.round(event.touches[0].clientX);
            var y = Math.round(event.touches[0].clientY);

            var thumb = document.getElementById("thumbstickpointer");

            thumb.style.position = "absolute";
            thumb.style.left = x + "px";
            thumb.style.top = y + "px";

            touchHistoryData.last_pos = touchHistoryData.position
            touchHistoryData.position.x = x;
            touchHistoryData.position.y = y;

            // the deslocation
            var mx = Math.floor(x - touchHistoryData.touch_start.x);
            var my = Math.floor(y - touchHistoryData.touch_start.y);


            var command = "MOVE;";
            command += mx + ";";
            command += my + ";";
            //console.log(command);
            sendCommand(command, true);

            document.getElementById("demo").innerHTML = x + ", " + y + " desloc = x: " + mx + " y:" + my;
        }

        document.addEventListener('click', function (event) {
            // Ignore clicks that weren't on the toggle button
            if (!event.target.hasAttribute('data-toggle-fullscreen')) return;

            // If there's an element in fullscreen, exit
            // Otherwise, enter it
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                document.documentElement.requestFullscreen();
            }
        }, false);

        function sendCommand(data, sync = true) {
            $.ajax
                ({
                    type: "POST",
                    //the url where you want to sent the userName and password to
                    url: 'http://' + serviceIPPort + '/setExampleTextMessage',
                    dataType: 'json',
                    async: sync,
                    //json object to sent to the authentication url
                    data: '{"command": "' + data + '"}',
                    success: function () {

                        // alert("Thanks!");
                    }
                })
        }
    </script>
</body>

</html>